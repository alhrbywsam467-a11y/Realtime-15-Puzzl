<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لعبة الأرقام أونلاين</title>
    <script src="https://js.pusher.com/8.4.0/pusher.min.js"></script>
    <style>
        body { background: #0f172a; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: sans-serif; }
        .status { background: #1e293b; padding: 10px 20px; border-radius: 50px; margin-bottom: 20px; border: 1px solid #334155; color: #4ade80; }
        .board { display: grid; grid-template-columns: repeat(4, 80px); gap: 10px; background: #1e293b; padding: 20px; border-radius: 15px; }
        .tile { width: 80px; height: 80px; background: #38bdf8; color: #0f172a; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; border-radius: 10px; cursor: pointer; }
        .tile.empty { background: #334155; cursor: default; }
    </style>
</head>
<body>
    <div class="status" id="status">جاري الاتصال بالسيرفر...</div>
    <div class="board" id="board"></div>

    <script>
        // إعدادات Pusher الخاصة بك
        const pusher = new Pusher('d97e993537a30a3c6a81', { 
            cluster: 'ap2',
            forceTLS: true
        });

        // ملاحظة: قنوات الـ Client Events يجب أن تبدأ بـ private- أو presence-
        // استخدمنا private- لأنها المطلوبة لإرسال الحركات مباشرة
        const channel = pusher.subscribe('private-game');

        let tiles = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0];

        pusher.connection.bind('connected', () => {
            document.getElementById('status').innerText = "متصل أونلاين ✅ - العب الآن";
        });

        // استقبال الحركة من اللاعب الآخر
        channel.bind('client-move', function(data) {
            tiles = data.newTiles;
            render();
        });

        function render() {
            const b = document.getElementById('board'); 
            b.innerHTML = '';
            tiles.forEach((n, i) => {
                const d = document.createElement('div');
                d.className = `tile ${n===0?'empty':''}`; 
                d.innerText = n || '';
                if(n !== 0) {
                    d.onclick = () => {
                        const z = tiles.indexOf(0);
                        if ([i-1, i+1, i-4, i+4].includes(z)) {
                            [tiles[i], tiles[z]] = [tiles[z], tiles[i]];
                            render();
                            // إرسال الحركة فوراً للاعبين الآخرين
                            channel.trigger('client-move', { newTiles: tiles });
                        }
                    };
                }
                b.appendChild(d);
            });
        }
        render();
    </script>
</body>
</html>
